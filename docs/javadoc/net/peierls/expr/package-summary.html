<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>net.peierls.expr (Expression framework)</title>
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="net.peierls.expr (Expression framework)";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../net/peierls/expr/package-summary.html">Package</a></li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Package</li>
<li>Next&nbsp;Package</li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?net/peierls/expr/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<h1 title="Package" class="title">Package&nbsp;net.peierls.expr</h1>
<div class="docSummary">
<div class="block">This package provides an extensible framework for building, evaluating, formatting, and parsing
 double-precision expressions: constants, variables, unary and binary operations,
 and binding of variables.</div>
</div>
<p>See:&nbsp;<a href="#package.description">Description</a></p>
</div>
<div class="contentContainer">
<ul class="blockList">
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Interface Summary table, listing interfaces, and an explanation">
<caption><span>Interface Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Interface</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../net/peierls/expr/BinaryOp.html" title="interface in net.peierls.expr">BinaryOp</a></td>
<td class="colLast">
<div class="block">A double precision binary operator, supporting evaluation and
 formatting (string representation).</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../net/peierls/expr/DelegatingOperator.html" title="interface in net.peierls.expr">DelegatingOperator</a></td>
<td class="colLast">
<div class="block">A partial implementation of both the unary and binary operator interfaces
 that delegates to an underlying operator.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../net/peierls/expr/Operator.html" title="interface in net.peierls.expr">Operator</a></td>
<td class="colLast">
<div class="block">A double precision operator with arity, precedence, fixity, and associativity.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../net/peierls/expr/UnaryOp.html" title="interface in net.peierls.expr">UnaryOp</a></td>
<td class="colLast">
<div class="block">A double precision unary operator, supporting evaluation and
 formatting (string representation).</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../net/peierls/expr/Visitor.html" title="interface in net.peierls.expr">Visitor</a>&lt;R&gt;</td>
<td class="colLast">
<div class="block">Visitor interface for computing values from known expression subtypes.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Class Summary table, listing classes, and an explanation">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../net/peierls/expr/BinaryOpExpression.html" title="class in net.peierls.expr">BinaryOpExpression</a></td>
<td class="colLast">
<div class="block">An expression representing the result of a binary operation on two subexpressions.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../net/peierls/expr/ConstantExpression.html" title="class in net.peierls.expr">ConstantExpression</a></td>
<td class="colLast">
<div class="block">An expression consisting of a constant value.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../net/peierls/expr/Expression.html" title="class in net.peierls.expr">Expression</a></td>
<td class="colLast">
<div class="block">A double-precision arithmetic expression on constants, variables,
 unary and binary operations, with local binding of variables to
 subexpressions, supporting evaluation and formatting (string
 representation).</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../net/peierls/expr/ExpressionParser.html" title="class in net.peierls.expr">ExpressionParser</a></td>
<td class="colLast">
<div class="block">A parser for Expression instances.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../net/peierls/expr/ExtendedExpression.html" title="class in net.peierls.expr">ExtendedExpression</a>&lt;T extends <a href="../../../net/peierls/expr/ExtendedExpression.html" title="class in net.peierls.expr">ExtendedExpression</a>&lt;T&gt;&gt;</td>
<td class="colLast">
<div class="block">Abstract base for expression subtypes that wrap existing
 expressions to provide new methods.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../net/peierls/expr/LetExpression.html" title="class in net.peierls.expr">LetExpression</a></td>
<td class="colLast">
<div class="block">An expression representing a subexpression with variable names
 bound to other expressions.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../net/peierls/expr/OperationExpression.html" title="class in net.peierls.expr">OperationExpression</a></td>
<td class="colLast">
<div class="block">An expression representing the result of a unary operation on a subexpression.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../net/peierls/expr/OperatorBuilder.html" title="class in net.peierls.expr">OperatorBuilder</a></td>
<td class="colLast">
<div class="block">Fluent construction of new operators.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../net/peierls/expr/TrigonometricExpression.html" title="class in net.peierls.expr">TrigonometricExpression</a></td>
<td class="colLast">
<div class="block">Extends expressions with trigonometric operations.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../net/peierls/expr/UnaryOpExpression.html" title="class in net.peierls.expr">UnaryOpExpression</a></td>
<td class="colLast">
<div class="block">An expression representing the result of a unary operation on a subexpression.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../net/peierls/expr/VariableExpression.html" title="class in net.peierls.expr">VariableExpression</a></td>
<td class="colLast">
<div class="block">An expression consisting of a single variable.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Enum Summary table, listing enums, and an explanation">
<caption><span>Enum Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Enum</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../net/peierls/expr/BasicOperator.html" title="enum in net.peierls.expr">BasicOperator</a></td>
<td class="colLast">
<div class="block">Basic double-precision arithmetic operators.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../net/peierls/expr/Operator.Type.html" title="enum in net.peierls.expr">Operator.Type</a></td>
<td class="colLast">
<div class="block">The type of operator, whether it is pre-, post-, or infix, and
 if the kind of associativity if infix.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../net/peierls/expr/TrigonometricOperator.html" title="enum in net.peierls.expr">TrigonometricOperator</a></td>
<td class="colLast">
<div class="block">Trigonometric operations on expressions.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Exception Summary table, listing exceptions, and an explanation">
<caption><span>Exception Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Exception</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../net/peierls/expr/BindingException.html" title="class in net.peierls.expr">BindingException</a></td>
<td class="colLast">
<div class="block">Base for exceptions thrown during expression evaluation.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../net/peierls/expr/DivisionByZeroException.html" title="class in net.peierls.expr">DivisionByZeroException</a></td>
<td class="colLast">
<div class="block">Thrown on a division by zero during evaluation</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../net/peierls/expr/EvaluationException.html" title="class in net.peierls.expr">EvaluationException</a></td>
<td class="colLast">
<div class="block">Base for exceptions thrown during expression evaluation</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../net/peierls/expr/ExpressionParsingException.html" title="class in net.peierls.expr">ExpressionParsingException</a></td>
<td class="colLast">
<div class="block">Thrown when expression parsing fails for some reason.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../net/peierls/expr/SelfReferenceException.html" title="class in net.peierls.expr">SelfReferenceException</a></td>
<td class="colLast">
<div class="block">Thrown a bound variable is used in its own binding expression.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../net/peierls/expr/UnboundVariableException.html" title="class in net.peierls.expr">UnboundVariableException</a></td>
<td class="colLast">
<div class="block">Thrown when a variable is not bound to a value during evaluation</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../net/peierls/expr/UnreferencedVariableException.html" title="class in net.peierls.expr">UnreferencedVariableException</a></td>
<td class="colLast">
<div class="block">Thrown when attempting to bind a variable that is not referenced by a subexpression.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../net/peierls/expr/WrapException.html" title="class in net.peierls.expr">WrapException</a></td>
<td class="colLast">
<div class="block">Base for exceptions thrown during expression evaluation.</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
<a name="package.description">
<!--   -->
</a>
<h2 title="Package net.peierls.expr Description">Package net.peierls.expr Description</h2>
<div class="block">This package provides an extensible framework for building, evaluating, formatting, and parsing
 double-precision expressions: constants, variables, unary and binary operations,
 and binding of variables.

 <h2>Usage</h2>

 The code snippets below assume the following static import:
 <pre>
 import static net.peierls.expr.Expression.expr;
 </pre>

 <h3>Atomic expressions</h3>

 Use the static <code>expr</code> methods to create atomic expressions.
 <pre>
 // Constant expressions
 ConstantExpression constExpr = expr(2.5);
 assertEquals(2.5, constExpr.value(), 0);

 // Variable expressions
 VariableExpression varExpr = expr("a");
 assertEquals("a", varExpr.varName());
 </pre>

 <h3>Operations</h3>

 Use the <code>apply</code> methods to build
 unary and binary operations, or use the equivalent
 built-in shortcut methods, which have overloadings
 to accept <code>double</code> or <code>String</code> arguments in place of
 <code>Expression</code>.
 <pre>
 Expression sumExpr1 = expr(2.5).apply(BasicOperator.PLUS, expr("a"));
 Expression sumExpr2 = expr(2.5).plus("a"); // more compact and readable

 assertEquals(sumExpr1, sumExpr2);
 </pre>

 <h4>Special rule for multiplication</h4>

 The built-in multiplication operator is formatted as whitespace;
 the parser will accept either whitespace or an asterisk, e.g., <code>a * b</code>.

 <h3>Bound expressions</h3>

 These are expressions binding variables in an expression to
 subexpression, analogous to these notations:
 <pre>
 let x = ..., y = ... in ...
 // or
 ... where x = ..., y = ...
 </pre>

 The <code>where</code> methods create bound expressions.
 <pre>
 Expression quadratic = expr("a").times(expr("x").squared())
     .plus(expr("b").times("x"))
     .plus("c");
 Expression quadWithBoundCoefficients = quadratic
     .where("a", 2, "b", 3, "c", 4);
 </pre>
 For more than three bindings, use
 <a href="../../../net/peierls/expr/Expression.html#where-java.util.Map-"><code>where(Map&lt;String, Expression&gt;)</code></a>.
 <pre>
 Map&lt;String, Expression&gt; bindings = new HashMap&lt;&gt;();
 bindings.put("a", expr(2));
 bindings.put("b", expr(3));
 bindings.put("c", expr(4));
 bindings.put("x", expr(1));
 Expression quadFullyBound = quadratic.where(bindings);

 // Similarly, but not equivalently:
 Expression quadFullyBound2 = quadWithBoundCoefficients.where("x", 1);

 assertFalse(quadFullyBound.equals(quadFullyBound2));
 assertEquals(quadFullyBound.value(), quadFullyBound2.value(), 0);
 </pre>

 <h3>Free variables</h3>

 The <a href="../../../net/peierls/expr/Expression.html#freeVariables--"><code>freeVariables</code></a> method returns a set
 of variables that are <strong>not</strong> bound in the expression.
 <pre>
 assertTrue(constExpr.freeVariables().isEmpty());
 assertEquals(ImmutableSet.of("x"), quadWithBoundCoefficients.freeVariables());
 </pre>

 <h3>Evaluation</h3>

 Calling <a href="../../../net/peierls/expr/Expression.html#value--"><code>value</code></a> on an expression with no free variables
 throws <a href="../../../net/peierls/expr/DivisionByZeroException.html" title="class in net.peierls.expr"><code>DivisionByZeroException</code></a> if a division by zero is encountered during
 the evaluation, otherwise it produces the value of the expression as a <code>double</code>.

 Evaluating an expression with free variables throws <a href="../../../net/peierls/expr/UnboundVariableException.html" title="class in net.peierls.expr"><code>UnboundVariableException</code></a>.
 You can test whether an expression has no free variables with
 <a href="../../../net/peierls/expr/Expression.html#evaluable--"><code>evaluable</code></a>.

 The <a href="../../../net/peierls/expr/Expression.html#optValue--"><code>optValue</code></a> method does not throw these exceptions,
 but rather returns an empty value in those cases.
 <pre>
 assertTrue(quadFullyBound.evaluable());
 assertEquals(9.0, quadFullyBound.value(), 0);
 assertEquals(42.0, expr(1).dividedBy(0).optValue().orElse(42));
 assertEquals(66.6, expr(1).plus("a").optValue().orElse(66.6));
 </pre>

 <h3>String representation</h3>

 Format an expression to a string representation with
 <a href="../../../net/peierls/expr/Expression.html#toString--"><code>toString</code></a>.
 <pre>
 assertEquals("2.5 + a", sumExpr1.toString());
 assertEquals("let a = 3 in 2.5 + a", sumExpr1.where("a", 3).toString());
 </pre>

 <h3>Parsing</h3>

 Parse expressions on the built-in operators with
 <a href="../../../net/peierls/expr/Expression.html#parseExpr-java.lang.String-"><code>parseExpr(String exprText)</code></a>.
 <pre>
 assertEquals(sumExpr1, parseExpr("2.5 + a"));
 assertEquals(sumExpr1.where("a", 3), parseExpr("let a = 3 in 2.5 + a"));
 </pre>

 <h2>Adding operators</h2>

 To add user-defined operators, define an enum type implementing
 <a href="../../../net/peierls/expr/DelegatingOperator.html" title="interface in net.peierls.expr"><code>DelegatingOperator</code></a>,
 using methods of <a href="../../../net/peierls/expr/OperatorBuilder.html" title="class in net.peierls.expr"><code>OperatorBuilder</code></a>
 to define the type of operator (prefix, postfix, infix left-associative,
 infix non-associative, or infix right-associative), the symbol used
 when formatting or parsing the operator, the
 <a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/DoubleUnaryOperator.html?is-external=true" title="class or interface in java.util.function">unary</a> or
 <a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/DoubleBinaryOperator.html?is-external=true" title="class or interface in java.util.function">binary</a> Java
 function used to evaluate the operator, and the precedence of the
 operator for parsing.
 <pre>
 public enum MyOp implements DelegatingOperator {
     // Space at end of symbol used when formatting, but ignored by parser.
     PI_R_SQUARED(prefix("pi_r_2 ", v -> Math.PI * v * v).precedence(100)),
     CUBED(postfix("^^^", v -> v * v * v).precedence(100)),
     ;
     final Operator delegate;
     MyOp(Operator delegate) { this.delegate = delegate; }
     @Override public Operator delegate() { return delegate; }

     // Convenience methods

     public static final UnaryOpExpression piRSquared(Expression e) {
         return e.apply(PI_R_SQUARED);
     }

     public static final UnaryOpExpression cubed(Expression e) {
         return e.apply(CUBED);
     }
 }
 </pre>
 To create an extended expression type that has an instance method for
 user-defined operators, extend
 <a href="../../../net/peierls/expr/ExtendedExpression.html" title="class in net.peierls.expr"><code>ExtendedExpression</code></a>.
 <pre>
 static class MyExpression extends ExtendedExpression&lt;MyExpression&gt; {
     // Constructor, required
     public MyExpression(Expression expr) {
         super(expr, MyExpression.class);
     }
     // Static factory, recommended
     public static MyExpression myExpr(Expression expr) {
         return wrap(expr, MyExpression.class);
     }
     // Convenience static factories, recommended
     public static MyExpression myExpr(double val) {
         return wrap(val, MyExpression.class);
     }
     public static MyExpression myExpr(String var) {
         return wrap(var, MyExpression.class);
     }
     // Operation instance methods, the reason for extending
     public final MyExpression piRSquared() {
         return apply(MyOp.PI_R_SQUARED);
     }
     public final MyExpression cubed() {
         return apply(MyOp.CUBED);
     }
 }
 </pre>
 To parse expressions on user-defined operators, pass the operator enum type(s) to
 <a href="../../../net/peierls/expr/Expression.html#parseExpr-java.lang.String-java.lang.Class-java.lang.Class...-"><code>parseExpr(str, userType1,...)</code></a>.
 <pre>
 Expression expected1 = expr(2).apply(MyOp.PI_R_SQUARED);
 assertEquals(expected1, parseExpr("pi_r_2 2", MyOp.class));

 Expression expected2 = expr(2).apply(MyOp.CUBED);
 assertEquals(expected2, parseExpr("2^^^", MyOp.class));
 </pre>
 Note that parsing with user-defined operators always uses
 the standard expression types, not the extended expression
 types, so it is possible that the parsed expression will
 not equal the same values constructed in code using the
 extended expression type.

 <h3>User-defined transformations</h3>

 Create new user-defined transformations of expressions by
 implementing the <a href="../../../net/peierls/expr/Visitor.html" title="interface in net.peierls.expr"><code>Visitor</code></a>
 interface and providing a static method to create an instance
 of the concrete visitor and call the
 <a href="../../../net/peierls/expr/Expression.html#accept-net.peierls.expr.Visitor-"><code>accept</code></a> method of
 an argument expression on that instance.
 See <a href="https://github.com/Tembrel/expressions/blob/master/src/test/java/net/peierls/expr/TraceVisitor.java#L11"
 target="_top">TraceVisitor</a> in the test code for a full example.</div>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../net/peierls/expr/package-summary.html">Package</a></li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Package</li>
<li>Next&nbsp;Package</li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?net/peierls/expr/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
